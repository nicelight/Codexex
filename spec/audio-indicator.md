# Audio Indicator Specification

- Background AudioTrigger подписывается на событие `idleSettled` агрегатора и отправляет `AUDIO_CHIME` во все активные контент-скрипты, когда сумма активных задач переходит из состояния `>0` в `0`.
- Тот же контроллер рассылает `AUDIO_SETTINGS_UPDATE` при изменении `sound`/`soundVolume`, чтобы вкладки мгновенно синхронизировали состояние.
- Контент-скрипт при инициализации создаёт скрытый `<audio id="codex-tasks-audio" data-codex-audio="chime">` и добавляет `<source src="chrome.runtime.getURL('media/oh-oh-icq-sound.mp3')" type="audio/mpeg">` в `document.body` (когда он доступен).
- Элемент помечен `aria-hidden="true"`, имеет нулевые размеры и `pointer-events: none`, чтобы не мешать пользовательскому вводу и навигации по DOM.
- Автовоспроизведение разблокируется после первого пользовательского жеста (`pointerdown`/`keydown`) вызовом `play()`/`pause()`; до разблокировки запросы на воспроизведение ставятся в очередь.
- При `AUDIO_CHIME` контроллер обнуляет `currentTime`, снимает `muted` и проигрывает звук, затем возвращает сохранённые настройки громкости/мьюта. Отказ `play()` приводит к повторной постановке в очередь до успешной разблокировки.
- Громкость нормализуется к диапазону `[0, 1]` (по умолчанию `0.2`); `sound=false` или `volume<=0` переводят элемент в `muted`.
- В случае отсутствия `document.body` или `chrome.runtime.getURL` инициализация откладывается, повторные запросы к `ensureAudioElement()` пересоздают элемент после появления необходимых зависимостей.
