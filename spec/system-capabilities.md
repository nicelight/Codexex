# System Capabilities & States ГўВЂВ” Codex Tasks Watcher

## Functional Capabilities

| Capability ID | ГђВћГђВїГђВёГ‘ВЃГђВ°ГђВЅГђВёГђВµ | ГђВўГ‘ВЂГђВёГђВіГђВіГђВµГ‘ВЂГ‘В‹ | ГђВћГ‘ВЃГђВЅГђВѕГђВІГђВЅГ‘В‹ГђВµ ГђВ°ГђВєГ‘В‚ГђВѕГ‘ВЂГ‘В‹ | ГђВђГ‘ВЂГ‘В‚ГђВµГ‘В„ГђВ°ГђВєГ‘В‚Г‘В‹ Г‘ВЃГђВѕГ‘ВЃГ‘В‚ГђВѕГ‘ВЏГђВЅГђВёГ‘ВЏ |
|---------------|----------|----------|-----------------|---------------------|
| CAP-01 | ГђВ”ГђВµГ‘В‚ГђВµГђВєГ‘В‚ГђВёГ‘ВЂГђВѕГђВІГђВ°ГђВЅГђВёГђВµ ГђВ°ГђВєГ‘В‚ГђВёГђВІГђВЅГђВѕГ‘ВЃГ‘В‚ГђВё ГђВ·ГђВ°ГђВґГђВ°Г‘В‡ ГђВЅГђВ° ГђВІГђВєГђВ»ГђВ°ГђВґГђВєГђВµ Codex. | MutationObserver, ГђВїГђВµГ‘ВЂГђВёГђВѕГђВґГђВёГ‘В‡ГђВµГ‘ВЃГђВєГђВёГђВ№ ГђВѕГђВїГ‘ВЂГђВѕГ‘ВЃ ГђВїГ‘ВЂГђВё ГђВїГ‘ВЂГђВѕГ‘ВЃГ‘В‚ГђВѕГђВµ. | ГђВљГђВѕГђВЅГ‘В‚ГђВµГђВЅГ‘В‚-Г‘ВЃГђВєГ‘ВЂГђВёГђВїГ‘В‚. | `TaskActivitySnapshot` (Г‘ВЃГђВј. Г‘ВЃГ‘В…ГђВµГђВјГ‘В‹ DTO). |
| CAP-02 | ГђВђГђВіГ‘ВЂГђВµГђВіГђВ°Г‘В†ГђВёГ‘ВЏ Г‘ВЃГђВѕГ‘ВЃГ‘В‚ГђВѕГ‘ВЏГђВЅГђВёГ‘ВЏ ГђВІГ‘ВЃГђВµГ‘В… ГђВІГђВєГђВ»ГђВ°ГђВґГђВѕГђВє ГђВё Г‘ВЂГђВ°Г‘ВЃГ‘В‡Г‘В‘Г‘В‚ `totalActiveCount`. | ГђВџГђВѕГђВ»Г‘ВѓГ‘В‡ГђВµГђВЅГђВёГђВµ `TASKS_UPDATE`, ГђВІГђВѕГ‘ВЃГ‘ВЃГ‘В‚ГђВ°ГђВЅГђВѕГђВІГђВ»ГђВµГђВЅГђВёГђВµ Г‘В‡ГђВµГ‘ВЂГђВµГђВ· alarm `codex-poll`. | Background service worker. | `AggregatedState.tabs`, `AggregatedState.lastTotal`. |
| CAP-03 | ГђВђГђВЅГ‘В‚ГђВёГђВґГ‘ВЂГђВµГђВ±ГђВµГђВ·ГђВі ГђВё ГђВІГ‘В‹ГђВґГђВ°Г‘В‡ГђВ° Г‘ВѓГђВІГђВµГђВґГђВѕГђВјГђВ»ГђВµГђВЅГђВёГ‘ВЏ ГђВїГ‘ВЂГђВё ГђВїГђВµГ‘ВЂГђВµГ‘В…ГђВѕГђВґГђВµ `totalActiveCount` >0 ГўВ†В’ 0. | ГђВГђВ·ГђВјГђВµГђВЅГђВµГђВЅГђВёГђВµ Г‘ВЃГ‘ВѓГђВјГђВјГ‘В‹ ГђВ°ГђВєГ‘В‚ГђВёГђВІГђВЅГ‘В‹Г‘В… ГђВ·ГђВ°ГђВґГђВ°Г‘В‡, Г‘В‚ГђВ°ГђВ№ГђВјГђВµГ‘ВЂ debounce. | Background service worker, Chrome Notifications. | `AggregatedState.debounce`. |
| CAP-04 | ГђВџГ‘ВЂГђВёГђВјГђВµГђВЅГђВµГђВЅГђВёГђВµ `autoDiscardableOff` ГђВґГђВ»Г‘ВЏ ГђВѕГ‘В‚Г‘ВЃГђВ»ГђВµГђВ¶ГђВёГђВІГђВ°ГђВµГђВјГ‘В‹Г‘В… ГђВІГђВєГђВ»ГђВ°ГђВґГђВѕГђВє Codex. | ГђВГђВЅГђВёГ‘В†ГђВёГђВ°ГђВ»ГђВёГђВ·ГђВ°Г‘В†ГђВёГ‘ВЏ aggregator, ГђВ»Г‘ВЋГђВ±ГђВѕГђВµ ГђВёГђВ·ГђВјГђВµГђВЅГђВµГђВЅГђВёГђВµ `AggregatedState.tabs`, ГђВѕГ‘В‡ГђВёГ‘ВЃГ‘В‚ГђВєГђВ° ГђВІГђВєГђВ»ГђВ°ГђВґГђВєГђВё. | Background service worker, Chrome Tabs API. | ГђВќГђВµГ‘В‚ ГђВґГђВѕГђВїГђВѕГђВ»ГђВЅГђВёГ‘В‚ГђВµГђВ»Г‘ВЊГђВЅГђВѕГђВіГђВѕ Г‘ВЃГђВѕГ‘ВЃГ‘В‚ГђВѕГ‘ВЏГђВЅГђВёГ‘ВЏ, ГђВґГђВµГђВ№Г‘ВЃГ‘В‚ГђВІГ‘ВѓГђВµГ‘В‚ ГђВЅГђВ°ГђВїГ‘ВЂГ‘ВЏГђВјГ‘ВѓГ‘ВЋ. |
| CAP-05 | ГђВћГ‘В‚ГђВѕГђВ±Г‘ВЂГђВ°ГђВ¶ГђВµГђВЅГђВёГђВµ ГђВ°ГђВіГ‘ВЂГђВµГђВіГђВёГ‘ВЂГђВѕГђВІГђВ°ГђВЅГђВЅГђВѕГђВіГђВѕ Г‘ВЃГђВѕГ‘ВЃГ‘В‚ГђВѕГ‘ВЏГђВЅГђВёГ‘ВЏ ГђВІ popup. | ГђВџГђВѕГђВ»Г‘ВЊГђВ·ГђВѕГђВІГђВ°Г‘В‚ГђВµГђВ»Г‘ВЊ ГђВѕГ‘В‚ГђВєГ‘ВЂГ‘В‹ГђВІГђВ°ГђВµГ‘В‚ popup ГўВ†В’ `POPUP_GET_STATE`. | Popup UI, background. | ГђВ“ГђВµГђВЅГђВµГ‘ВЂГђВёГ‘ВЂГ‘ВѓГђВµГђВјГ‘В‹ГђВ№ `PopupRenderState` (ГђВЅГђВ° ГђВѕГ‘ВЃГђВЅГђВѕГђВІГђВµ `AggregatedState`). |
| CAP-06 | ГђВџГђВµГ‘ВЂГђВёГђВѕГђВґГђВёГ‘В‡ГђВµГ‘ВЃГђВєГђВёГђВ№ ГђВїГђВёГђВЅГђВі ГђВІГђВєГђВ»ГђВ°ГђВґГђВѕГђВє ГђВё ГђВјГђВ°Г‘ВЂГђВєГђВёГ‘ВЂГђВѕГђВІГђВєГђВ° `STALE`. | ГђВЎГ‘ВЂГђВ°ГђВ±ГђВ°Г‘В‚Г‘В‹ГђВІГђВ°ГђВЅГђВёГђВµ `chrome.alarms` (`codex-poll`). | Background service worker. | `AggregatedState.tabs[].heartbeat.status`, Г‘ВЃГђВѕГђВѕГђВ±Г‘В‰ГђВµГђВЅГђВёГ‘ВЏ `PING`. |
| CAP-07 | ГђВџГђВѕГђВґГђВґГђВµГ‘ВЂГђВ¶ГђВєГђВ° heartbeat ГђВґГђВ»Г‘ВЏ ГђВєГђВѕГђВЅГ‘В‚Г‘ВЂГђВѕГђВ»Г‘ВЏ ГђВ¶ГђВёГђВІГђВѕГ‘ВЃГ‘В‚ГђВё ГђВІГђВєГђВ»ГђВ°ГђВґГђВѕГђВє. | ГђВўГђВ°ГђВ№ГђВјГђВµГ‘ВЂ ГђВєГђВѕГђВЅГ‘В‚ГђВµГђВЅГ‘В‚-Г‘ВЃГђВєГ‘ВЂГђВёГђВїГ‘В‚ГђВ°, Г‘ВЂГђВµГђВ°ГђВєГ‘В†ГђВёГ‘ВЏ ГђВЅГђВ° `PING`, ГђВєГђВѕГђВЅГ‘В‚Г‘ВЂГђВѕГђВ»Г‘ВЊ ГђВїГ‘ВЂГђВѕГђВїГ‘ВѓГ‘ВЃГђВєГђВѕГђВІ ГђВїГђВѕ `AggregatedState`. | ГђВљГђВѕГђВЅГ‘В‚ГђВµГђВЅГ‘В‚-Г‘ВЃГђВєГ‘ВЂГђВёГђВїГ‘В‚, background. | `ContentScriptHeartbeat`, `AggregatedState.tabs[].heartbeat`. |

## ГђВЎГђВѕГ‘ВЃГ‘В‚ГђВѕГ‘ВЏГђВЅГђВёГ‘ВЏ Г‘ВЃГђВёГ‘ВЃГ‘В‚ГђВµГђВјГ‘В‹

### TaskActivitySnapshot (ГђВІ ГђВєГђВѕГђВЅГ‘В‚ГђВµГђВЅГ‘В‚-Г‘ВЃГђВєГ‘ВЂГђВёГђВїГ‘В‚ГђВµ)
- `origin`: URL ГђВІГђВєГђВ»ГђВ°ГђВґГђВєГђВё.
- `active`: ГђВ±Г‘ВѓГђВ»ГђВµГђВІ Г‘В„ГђВ»ГђВ°ГђВі ГђВЅГђВ°ГђВ»ГђВёГ‘В‡ГђВёГ‘ВЏ ГђВ°ГђВєГ‘В‚ГђВёГђВІГђВЅГ‘В‹Г‘В… ГђВ·ГђВ°ГђВґГђВ°Г‘В‡.
- `count`: ГђВєГђВѕГђВ»ГђВёГ‘В‡ГђВµГ‘ВЃГ‘В‚ГђВІГђВѕ ГђВ·ГђВ°ГђВґГђВ°Г‘В‡ (ГђВїГђВѕ ГђВјГђВ°ГђВєГ‘ВЃГђВёГђВјГ‘ВѓГђВјГ‘Вѓ ГђВјГђВµГђВ¶ГђВґГ‘Вѓ ГђВґГђВµГ‘В‚ГђВµГђВєГ‘В‚ГђВѕГ‘ВЂГђВ°ГђВјГђВё).
- `signals`: ГђВјГђВ°Г‘ВЃГ‘ВЃГђВёГђВІ ГђВґГђВµГ‘В‚ГђВ°ГђВ»ГђВёГђВ·ГђВёГ‘ВЂГђВѕГђВІГђВ°ГђВЅГђВЅГ‘В‹Г‘В… ГђВґГђВѕГђВєГђВ°ГђВ·ГђВ°Г‘В‚ГђВµГђВ»Г‘ВЊГ‘ВЃГ‘В‚ГђВІ.
- `ts`: Unix-ГђВІГ‘ВЂГђВµГђВјГ‘ВЏ (ГђВјГ‘ВЃ) Г‘В„ГђВѕГ‘ВЂГђВјГђВёГ‘ВЂГђВѕГђВІГђВ°ГђВЅГђВёГ‘ВЏ Г‘ВЃГђВЅГђВёГђВјГђВєГђВ°.

### ContentScriptHeartbeat
- `origin`: URL ГђВІГђВєГђВ»ГђВ°ГђВґГђВєГђВё, ГђВёГђВ· ГђВєГђВѕГ‘В‚ГђВѕГ‘ВЂГђВѕГђВ№ ГђВѕГ‘В‚ГђВїГ‘ВЂГђВ°ГђВІГђВ»ГђВµГђВЅ heartbeat.
- `ts`: Unix-ГђВІГ‘ВЂГђВµГђВјГ‘ВЏ (ГђВјГ‘ВЃ) ГђВѕГ‘В‚ГђВїГ‘ВЂГђВ°ГђВІГђВєГђВё heartbeat.
- `lastUpdateTs`: ГђВѕГ‘В‚ГђВјГђВµГ‘В‚ГђВєГђВ° ГђВІГ‘ВЂГђВµГђВјГђВµГђВЅГђВё ГђВїГђВѕГ‘ВЃГђВ»ГђВµГђВґГђВЅГђВµГђВіГђВѕ `TASKS_UPDATE`, ГђВґГђВѕГ‘ВЃГ‘В‚Г‘ВѓГђВїГђВЅГђВѕГђВіГђВѕ ГђВєГђВѕГђВЅГ‘В‚ГђВµГђВЅГ‘В‚-Г‘ВЃГђВєГ‘ВЂГђВёГђВїГ‘В‚Г‘Вѓ.
- `intervalMs`: ГђВѕГђВ¶ГђВёГђВґГђВ°ГђВµГђВјГ‘В‹ГђВ№ ГђВёГђВЅГ‘В‚ГђВµГ‘ВЂГђВІГђВ°ГђВ» ГђВґГђВѕ Г‘ВЃГђВ»ГђВµГђВґГ‘ВѓГ‘ВЋГ‘В‰ГђВµГђВіГђВѕ heartbeat (ГђВїГђВѕ Г‘ВѓГђВјГђВѕГђВ»Г‘В‡ГђВ°ГђВЅГђВёГ‘ВЋ 15000 ГђВјГ‘ВЃ).
- `respondingToPing`: ГђВ±Г‘ВѓГђВ»ГђВµГђВІГђВѕ, Г‘ВЃГђВёГђВіГђВЅГђВ°ГђВ»ГђВёГђВ·ГђВёГ‘ВЂГ‘ВѓГђВµГ‘В‚, Г‘В‡Г‘В‚ГђВѕ heartbeat ГђВѕГ‘В‚ГђВїГ‘ВЂГђВ°ГђВІГђВ»ГђВµГђВЅ ГђВІ ГђВѕГ‘В‚ГђВІГђВµГ‘В‚ ГђВЅГђВ° `PING` (ГђВѕГђВїГ‘В†ГђВёГђВѕГђВЅГђВ°ГђВ»Г‘ВЊГђВЅГђВѕ ГђВґГђВ»Г‘ВЏ ГђВґГђВёГђВ°ГђВіГђВЅГђВѕГ‘ВЃГ‘В‚ГђВёГђВєГђВё).

### AggregatedState (ГђВІ background)
- `tabs`: Г‘ВЃГђВ»ГђВѕГђВІГђВ°Г‘ВЂГ‘ВЊ `tabId -> { origin, title, count, active, updatedAt, lastSeenAt, heartbeat, signals? }`, ГђВіГђВґГђВµ `updatedAt` ГўВЂВ” Unix-ГђВІГ‘ВЂГђВµГђВјГ‘ВЏ (ГђВјГ‘ВЃ) ГђВїГђВѕГ‘ВЃГђВ»ГђВµГђВґГђВЅГђВµГђВіГђВѕ `TASKS_UPDATE`, `lastSeenAt` ГўВЂВ” ГђВјГђВ°ГђВєГ‘ВЃГђВёГђВјГ‘ВѓГђВј ГђВјГђВµГђВ¶ГђВґГ‘Вѓ `updatedAt` ГђВё ГђВІГ‘ВЂГђВµГђВјГђВµГђВЅГђВµГђВј ГђВїГђВѕГ‘ВЃГђВ»ГђВµГђВґГђВЅГђВµГђВіГђВѕ `TASKS_HEARTBEAT`, ГђВ° `signals` Г‘В…Г‘ВЂГђВ°ГђВЅГђВёГ‘В‚ ГђВїГђВѕГ‘ВЃГђВ»ГђВµГђВґГђВЅГђВёГђВ№ Г‘ВЃГђВЅГђВёГђВјГђВѕГђВє ГђВґГђВµГ‘В‚ГђВµГђВєГ‘В‚ГђВѕГ‘ВЂГђВѕГђВІ ГђВё ГђВјГђВѕГђВ¶ГђВµГ‘В‚ ГђВѕГ‘В‚Г‘ВЃГ‘ВѓГ‘В‚Г‘ВЃГ‘В‚ГђВІГђВѕГђВІГђВ°Г‘В‚Г‘ВЊ ГђВґГђВ»Г‘ВЏ ГђВІГђВєГђВ»ГђВ°ГђВґГђВѕГђВє ГђВ±ГђВµГђВ· ГђВґГђВµГ‘В‚ГђВ°ГђВ»Г‘ВЊГђВЅГ‘В‹Г‘В… Г‘ВЃГђВёГђВіГђВЅГђВ°ГђВ»ГђВѕГђВІ.
- `lastTotal`: Г‘ВЃГ‘ВѓГђВјГђВјГђВ° `count` ГђВІГ‘ВЃГђВµГ‘В… ГђВІГђВєГђВ»ГђВ°ГђВґГђВѕГђВє.
- `debounce`: `{ ms, since }` ГўВЂВ” ГђВїГђВ°Г‘ВЂГђВ°ГђВјГђВµГ‘В‚Г‘ВЂГ‘В‹ ГђВ°ГђВЅГ‘В‚ГђВёГђВґГ‘ВЂГђВµГђВ±ГђВµГђВ·ГђВіГђВ°, ГђВіГђВґГђВµ `since` Г‘В„ГђВёГђВєГ‘ВЃГђВёГ‘ВЂГ‘ВѓГђВµГ‘В‚ Unix-ГђВІГ‘ВЂГђВµГђВјГ‘ВЏ (ГђВјГ‘ВЃ) ГђВЅГђВ°Г‘В‡ГђВ°ГђВ»ГђВ° ГђВѕГђВєГђВЅГђВ° ГђВё Г‘ВЃГђВ±Г‘ВЂГђВ°Г‘ВЃГ‘В‹ГђВІГђВ°ГђВµГ‘В‚Г‘ВЃГ‘ВЏ ГђВІ `0`, ГђВєГђВѕГђВіГђВґГђВ° ГђВѕГђВєГђВЅГђВѕ ГђВЅГђВµГђВ°ГђВєГ‘В‚ГђВёГђВІГђВЅГђВѕ; ГђВІ v0.1.0 ГђВёГ‘ВЃГђВїГђВѕГђВ»Г‘ВЊГђВ·Г‘ВѓГђВµГ‘В‚Г‘ВЃГ‘ВЏ ГђВ·ГђВЅГђВ°Г‘В‡ГђВµГђВЅГђВёГђВµ ГђВїГђВѕ Г‘ВѓГђВјГђВѕГђВ»Г‘В‡ГђВ°ГђВЅГђВёГ‘ВЋ 12 000 ГђВјГ‘ВЃ (ГђВѕГђВіГ‘ВЂГђВ°ГђВЅГђВёГ‘В‡ГђВёГђВІГђВ°ГђВµГ‘В‚Г‘ВЃГ‘ВЏ ГђВґГђВёГђВ°ГђВїГђВ°ГђВ·ГђВѕГђВЅГђВѕГђВј 0ГўВЂВ“60 000).
- `tabs[].heartbeat`: ГђВѕГђВ±Г‘ВЉГђВµГђВєГ‘В‚ `{ lastReceivedAt, expectedIntervalMs, missedCount, status }`, ГђВіГђВґГђВµ `status` ГђВїГ‘ВЂГђВёГђВЅГђВёГђВјГђВ°ГђВµГ‘В‚ ГђВ·ГђВЅГђВ°Г‘В‡ГђВµГђВЅГђВёГ‘ВЏ `OK` ГђВёГђВ»ГђВё `STALE` ГђВїГ‘ВЂГђВё ГђВїГ‘ВЂГђВµГђВІГ‘В‹Г‘В€ГђВµГђВЅГђВёГђВё ГђВѕГђВєГђВЅГђВ° `expectedIntervalMs * 3`.

### UserSettings (ГђВ·ГђВ°Г‘ВЂГђВµГђВ·ГђВµГ‘ВЂГђВІГђВёГ‘ВЂГђВѕГђВІГђВ°ГђВЅГђВѕ ГђВґГђВ»Г‘ВЏ v0.2.0+)
- ГђВЎГ‘В…ГђВµГђВјГђВ° `CodexTasksUserSettings` ГђВїГђВѕГђВґГђВіГђВѕГ‘В‚ГђВѕГђВІГђВ»ГђВµГђВЅГђВ°, ГђВЅГђВѕ ГђВІ ГђВєГђВѕГђВґГђВµ v0.1.0 ГђВЅГђВµ ГђВёГ‘ВЃГђВїГђВѕГђВ»Г‘ВЊГђВ·Г‘ВѓГђВµГ‘В‚Г‘ВЃГ‘ВЏ.
- ГђВџГђВѕГђВ»Г‘ВЏ: `debounceMs`, `sound`, `autoDiscardableOff`, `showBadgeCount`; ГђВїГ‘ВЂГђВµГђВґГђВїГђВѕГђВ»ГђВ°ГђВіГђВ°ГђВµГ‘В‚Г‘ВЃГ‘ВЏ Г‘В…Г‘ВЂГђВ°ГђВЅГђВµГђВЅГђВёГђВµ ГђВІ `chrome.storage.sync`.
- ГђВ’ Г‘В‚ГђВµГђВєГ‘ВѓГ‘В‰ГђВµГђВ№ Г‘ВЂГђВµГђВ°ГђВ»ГђВёГђВ·ГђВ°Г‘В†ГђВёГђВё ГђВ·ГђВЅГђВ°Г‘В‡ГђВµГђВЅГђВёГ‘ВЏ `debounceMs` ГђВё `autoDiscardableOff` ГђВ·ГђВ°Г‘В€ГђВёГ‘В‚Г‘В‹ ГђВєГђВѕГђВЅГ‘ВЃГ‘В‚ГђВ°ГђВЅГ‘В‚ГђВ°ГђВјГђВё.

### NotificationState
- ГђВљГђВѕГ‘ВЃГђВІГђВµГђВЅГђВЅГђВѕ Г‘В…Г‘ВЂГђВ°ГђВЅГђВёГ‘В‚Г‘ВЃГ‘ВЏ Г‘В‡ГђВµГ‘ВЂГђВµГђВ· Г‘ВЃГђВёГ‘ВЃГ‘В‚ГђВµГђВјГђВЅГ‘В‹ГђВµ Г‘ВѓГђВІГђВµГђВґГђВѕГђВјГђВ»ГђВµГђВЅГђВёГ‘ВЏ; ГђВёГђВґГђВµГђВјГђВїГђВѕГ‘В‚ГђВµГђВЅГ‘В‚ГђВЅГђВѕГ‘ВЃГ‘В‚Г‘ВЊ ГђВґГђВѕГ‘ВЃГ‘В‚ГђВёГђВіГђВ°ГђВµГ‘В‚Г‘ВЃГ‘ВЏ ГђВїГ‘ВЂГђВѕГђВІГђВµГ‘ВЂГђВєГђВѕГђВ№ `lastTotal` ГђВё `debounce.since`.

## ГђВўГ‘ВЂГђВёГђВіГђВіГђВµГ‘ВЂГ‘В‹ ГђВїГђВµГ‘ВЂГђВµГ‘В…ГђВѕГђВґГђВѕГђВІ Г‘ВЃГђВѕГ‘ВЃГ‘В‚ГђВѕГ‘ВЏГђВЅГђВёГђВ№

| ГђВЎГђВѕГђВ±Г‘В‹Г‘В‚ГђВёГђВµ | ГђВГђВ·ГђВјГђВµГђВЅГ‘ВЏГђВµГђВјГђВѕГђВµ Г‘ВЃГђВѕГ‘ВЃГ‘В‚ГђВѕГ‘ВЏГђВЅГђВёГђВµ | ГђВ›ГђВѕГђВіГђВёГђВєГђВ° |
|---------|----------------------|--------|
| `TASKS_UPDATE` ГђВёГђВ· ГђВєГђВѕГђВЅГ‘В‚ГђВµГђВЅГ‘В‚-Г‘ВЃГђВєГ‘ВЂГђВёГђВїГ‘В‚ГђВ° | `AggregatedState.tabs`, `AggregatedState.lastTotal`, `AggregatedState.debounce.since` | ГђВћГђВ±ГђВЅГђВѕГђВІГђВёГ‘В‚Г‘ВЊ ГђВІГђВєГђВ»ГђВ°ГђВґГђВєГ‘Вѓ, ГђВїГђВµГ‘ВЂГђВµГ‘ВЃГ‘В‡ГђВёГ‘В‚ГђВ°Г‘В‚Г‘ВЊ Г‘ВЃГ‘ВѓГђВјГђВјГ‘Вѓ, ГђВїГ‘ВЂГђВё ГђВїГђВµГ‘ВЂГђВµГ‘В…ГђВѕГђВґГђВµ ГђВІ 0 ГђВ·ГђВ°ГђВїГ‘ВѓГ‘ВЃГ‘В‚ГђВёГ‘В‚Г‘ВЊ ГђВ°ГђВЅГ‘В‚ГђВёГђВґГ‘ВЂГђВµГђВ±ГђВµГђВ·ГђВі, ГђВїГђВµГ‘ВЂГђВµГ‘ВѓГ‘ВЃГ‘В‚ГђВ°ГђВЅГђВѕГђВІГђВёГ‘В‚Г‘ВЊ `autoDiscardable=false` ГђВґГђВ»Г‘ВЏ ГђВІГђВєГђВ»ГђВ°ГђВґГђВєГђВё. |
| `AggregatedState` ГђВёГђВ·ГђВјГђВµГђВЅГђВёГђВ»Г‘ВЃГ‘ВЏ (Г‘В‡ГђВµГ‘ВЂГђВµГђВ· `onStateChange`) | ГђВќГђВµГ‘В‚ (ГђВѕГђВїГђВµГ‘ВЂГђВ°Г‘В†ГђВёГ‘ВЏ ГђВЅГђВ°ГђВґ ГђВІГђВєГђВ»ГђВ°ГђВґГђВєГђВѕГђВ№) | ГђВљГђВѕГђВЅГ‘В‚Г‘ВЂГђВѕГђВ»ГђВ»ГђВµГ‘ВЂ `alarms` ГђВїГ‘ВЂГђВѕГ‘В…ГђВѕГђВґГђВёГ‘В‚ ГђВїГђВѕ `tabs` ГђВё ГђВІГ‘В‹ГђВ·Г‘В‹ГђВІГђВ°ГђВµГ‘В‚ `chrome.tabs.update({ autoDiscardable: false })` ГђВґГђВ»Г‘ВЏ ГђВІГ‘ВЃГђВµГ‘В… ГђВѕГ‘В‚Г‘ВЃГђВ»ГђВµГђВ¶ГђВёГђВІГђВ°ГђВµГђВјГ‘В‹Г‘В… ГђВІГђВєГђВ»ГђВ°ГђВґГђВѕГђВє; ГђВѕГ‘В‡ГђВёГ‘В‰ГђВ°ГђВµГ‘В‚ Г‘ВЃГђВїГђВёГ‘ВЃГђВѕГђВє ГђВїГ‘ВЂГђВё Г‘ВѓГђВґГђВ°ГђВ»ГђВµГђВЅГђВёГђВё. |
| `TASKS_HEARTBEAT` ГђВёГђВ· ГђВєГђВѕГђВЅГ‘В‚ГђВµГђВЅГ‘В‚-Г‘ВЃГђВєГ‘ВЂГђВёГђВїГ‘В‚ГђВ° | `AggregatedState.tabs[].lastSeenAt`, `AggregatedState.tabs[].heartbeat` | ГђВћГђВ±ГђВЅГђВѕГђВІГђВёГ‘В‚Г‘ВЊ `lastReceivedAt`, Г‘ВЃГђВ±Г‘ВЂГђВѕГ‘ВЃГђВёГ‘В‚Г‘ВЊ `missedCount`, ГђВІГ‘В‹Г‘ВЃГ‘В‚ГђВ°ГђВІГђВёГ‘В‚Г‘ВЊ `status=OK`. |
| ГђВўГђВ°ГђВ№ГђВјГђВµГ‘ВЂ `debounce` ГђВёГ‘ВЃГ‘В‚Г‘В‘ГђВє | `AggregatedState.debounce.since`, Г‘ВЃГђВёГ‘ВЃГ‘В‚ГђВµГђВјГђВЅГђВѕГђВµ Г‘ВѓГђВІГђВµГђВґГђВѕГђВјГђВ»ГђВµГђВЅГђВёГђВµ | ГђВџГ‘ВЂГђВѕГђВІГђВµГ‘ВЂГђВёГ‘В‚Г‘ВЊ, Г‘В‡Г‘В‚ГђВѕ `lastTotal==0` ГђВё ГђВІГ‘ВЃГђВµ `count==0`; Г‘ВЃГђВѕГђВ·ГђВґГђВ°Г‘В‚Г‘ВЊ Г‘ВѓГђВІГђВµГђВґГђВѕГђВјГђВ»ГђВµГђВЅГђВёГђВµ, Г‘ВЃГђВ±Г‘ВЂГђВѕГ‘ВЃГђВёГ‘В‚Г‘ВЊ `since`. |
| ГђВ—ГђВ°ГђВєГ‘ВЂГ‘В‹Г‘В‚ГђВёГђВµ ГђВІГђВєГђВ»ГђВ°ГђВґГђВєГђВё (`tabs.onRemoved`) | `AggregatedState.tabs`, `AggregatedState.lastTotal` | ГђВЈГђВґГђВ°ГђВ»ГђВёГ‘В‚Г‘ВЊ ГђВІГђВєГђВ»ГђВ°ГђВґГђВєГ‘Вѓ, ГђВїГђВµГ‘ВЂГђВµГ‘ВЃГ‘В‡ГђВёГ‘В‚ГђВ°Г‘В‚Г‘ВЊ Г‘ВЃГ‘ВѓГђВјГђВјГ‘Вѓ, ГђВїГ‘ВЂГђВё ГђВЅГ‘ВѓГђВ»ГђВµ Г‘ВЃГђВ±Г‘ВЂГђВѕГ‘ВЃГђВёГ‘В‚Г‘ВЊ `debounce.since`. |
| Alarm `codex-poll` | `AggregatedState.tabs[].heartbeat.status` | ГђВ’Г‘В‹ГђВ·Г‘В‹ГђВІГђВ°ГђВµГ‘В‚ `evaluateHeartbeatStatuses()`: ГђВїГђВѕГђВјГђВµГ‘В‡ГђВ°ГђВµГ‘В‚ ГђВІГђВєГђВ»ГђВ°ГђВґГђВєГђВё ГђВєГђВ°ГђВє `STALE`, Г‘ВѓГђВІГђВµГђВ»ГђВёГ‘В‡ГђВёГђВІГђВ°ГђВµГ‘В‚ `missedCount`, ГђВѕГ‘В‚ГђВїГ‘ВЂГђВ°ГђВІГђВ»Г‘ВЏГђВµГ‘В‚ `PING`. |
| ГђВћГ‘В‚ГђВєГ‘ВЂГ‘В‹Г‘В‚ГђВёГђВµ popup | `PopupRenderState` (ГђВІГ‘ВЂГђВµГђВјГђВµГђВЅГђВЅГ‘В‹ГђВ№ ГђВѕГђВ±Г‘ВЉГђВµГђВєГ‘В‚) | Background Г‘В„ГђВѕГ‘ВЂГђВјГђВёГ‘ВЂГ‘ВѓГђВµГ‘В‚ Г‘ВЃГђВЅГђВёГђВјГђВѕГђВє (`generatePopupRenderState`) ГђВё ГђВІГђВѕГђВ·ГђВІГ‘ВЂГђВ°Г‘В‰ГђВ°ГђВµГ‘В‚ ГђВїГђВѕ Г‘ВЃГђВѕГђВѕГђВ±Г‘В‰ГђВµГђВЅГђВёГ‘ВЋ `POPUP_GET_STATE`. |
| ГђВГђВ·ГђВјГђВµГђВЅГђВµГђВЅГђВёГђВµ `chrome.storage.session['codex.tasks.verbose']` | ГђВЈГ‘ВЂГђВѕГђВІГђВµГђВЅГ‘ВЊ ГђВ»ГђВѕГђВіГђВёГ‘ВЂГђВѕГђВІГђВ°ГђВЅГђВёГ‘ВЏ background/content | ГђВ›ГђВѕГђВіГђВіГђВµГ‘ВЂ ГђВїГђВµГ‘ВЂГђВµГ‘ВЃГ‘В‡ГђВёГ‘В‚Г‘В‹ГђВІГђВ°ГђВµГ‘В‚ verbose-Г‘ВЂГђВµГђВ¶ГђВёГђВј ГђВё ГђВЅГђВ°Г‘В‡ГђВёГђВЅГђВ°ГђВµГ‘В‚ ГђВІГ‘В‹ГђВІГђВѕГђВґГђВёГ‘В‚Г‘ВЊ debug-Г‘ВЃГђВѕГђВѕГђВ±Г‘В‰ГђВµГђВЅГђВёГ‘ВЏ. |

## ГђВ–ГђВёГђВ·ГђВЅГђВµГђВЅГђВЅГ‘В‹ГђВ№ Г‘В†ГђВёГђВєГђВ»

1. ГђВџГ‘ВЂГђВё Г‘ВѓГ‘ВЃГ‘В‚ГђВ°ГђВЅГђВѕГђВІГђВєГђВµ Г‘ВЂГђВ°Г‘ВЃГ‘В€ГђВёГ‘ВЂГђВµГђВЅГђВёГ‘ВЏ Г‘ВЃГђВѕГђВ·ГђВґГђВ°Г‘В‘Г‘В‚Г‘ВЃГ‘ВЏ `AggregatedState` Г‘ВЃ ГђВїГ‘ВѓГ‘ВЃГ‘В‚Г‘В‹ГђВјГђВё ГђВІГђВєГђВ»ГђВ°ГђВґГђВєГђВ°ГђВјГђВё ГђВё `lastTotal=0`.
2. ГђВџГђВµГ‘ВЂГђВІГђВѕГђВµ `TASKS_UPDATE` ГђВёГђВЅГђВёГ‘В†ГђВёГђВёГ‘ВЂГ‘ВѓГђВµГ‘В‚ ГђВґГђВѕГђВ±ГђВ°ГђВІГђВ»ГђВµГђВЅГђВёГђВµ ГђВІГђВєГђВ»ГђВ°ГђВґГђВєГђВё ГђВё Г‘ВЂГђВ°Г‘ВЃГ‘В‡Г‘В‘Г‘В‚ Г‘ВЃГ‘ВѓГђВјГђВјГ‘В‹.
3. ГђВ•Г‘ВЃГђВ»ГђВё ГђВІГђВєГђВ»ГђВ°ГђВґГђВєГђВё ГђВѕГ‘В‚Г‘ВЃГ‘ВѓГ‘В‚Г‘ВЃГ‘В‚ГђВІГ‘ВѓГ‘ВЋГ‘В‚ (`tabs` ГђВїГ‘ВѓГ‘ВЃГ‘В‚), Г‘ВѓГђВІГђВµГђВґГђВѕГђВјГђВ»ГђВµГђВЅГђВёГ‘ВЏ ГђВЅГђВµ Г‘ВЃГђВѕГђВ·ГђВґГђВ°Г‘ВЋГ‘В‚Г‘ВЃГ‘ВЏ, popup ГђВїГђВѕГђВєГђВ°ГђВ·Г‘В‹ГђВІГђВ°ГђВµГ‘В‚ ГђВїГ‘ВѓГ‘ВЃГ‘В‚ГђВѕГђВµ Г‘ВЃГђВѕГ‘ВЃГ‘В‚ГђВѕГ‘ВЏГђВЅГђВёГђВµ.
4. ГђВџГ‘ВЂГђВё ГђВґГђВ»ГђВёГ‘В‚ГђВµГђВ»Г‘ВЊГђВЅГђВѕГђВј ГђВ±ГђВµГђВ·ГђВґГђВµГђВ№Г‘ВЃГ‘В‚ГђВІГђВёГђВё Г‘ВЃГђВµГ‘ВЂГђВІГђВёГ‘ВЃ-ГђВІГђВѕГ‘ВЂГђВєГђВµГ‘ВЂ ГђВјГђВѕГђВ¶ГђВµГ‘В‚ ГђВ±Г‘В‹Г‘В‚Г‘ВЊ ГђВІГ‘В‹ГђВіГ‘ВЂГ‘ВѓГђВ¶ГђВµГђВЅ; alarm ГђВіГђВ°Г‘ВЂГђВ°ГђВЅГ‘В‚ГђВёГ‘ВЂГ‘ВѓГђВµГ‘В‚ ГђВµГђВіГђВѕ ГђВїГђВµГ‘ВЂГђВёГђВѕГђВґГђВёГ‘В‡ГђВµГ‘ВЃГђВєГђВёГђВ№ ГђВ·ГђВ°ГђВїГ‘ВѓГ‘ВЃГђВє, ГђВїГ‘ВЂГђВѕГђВІГђВµГ‘ВЂГ‘ВЏГђВµГ‘В‚ `tabs[].heartbeat.status` ГђВё ГђВёГђВЅГђВёГ‘В†ГђВёГђВёГ‘ВЂГ‘ВѓГђВµГ‘В‚ `PING`/ГђВїГђВѕГђВІГ‘В‚ГђВѕГ‘ВЂГђВЅГђВѕГђВµ Г‘ВЃГђВєГђВ°ГђВЅГђВёГ‘ВЂГђВѕГђВІГђВ°ГђВЅГђВёГђВµ, ГђВµГ‘ВЃГђВ»ГђВё heartbeat Г‘ВѓГ‘ВЃГ‘В‚ГђВ°Г‘ВЂГђВµГђВ».
5. ГђВџГђВѕГђВ»Г‘ВЊГђВ·ГђВѕГђВІГђВ°Г‘В‚ГђВµГђВ»Г‘ВЊ ГђВІГђВ·ГђВ°ГђВёГђВјГђВѕГђВґГђВµГђВ№Г‘ВЃГ‘В‚ГђВІГ‘ВѓГђВµГ‘В‚ Г‘ВЃ Г‘ВѓГђВІГђВµГђВґГђВѕГђВјГђВ»ГђВµГђВЅГђВёГђВµГђВј ГђВёГђВ»ГђВё popup ГђВ±ГђВµГђВ· ГђВІГђВ»ГђВёГ‘ВЏГђВЅГђВёГ‘ВЏ ГђВЅГђВ° Г‘ВЃГ‘В‡Г‘В‘Г‘В‚Г‘В‡ГђВёГђВєГђВё ГђВ·ГђВ°ГђВґГђВ°Г‘В‡; ГђВѕГ‘В‚ГђВєГ‘ВЂГ‘В‹Г‘В‚ГђВёГђВµ popup ГђВѕГ‘В‚ГђВѕГђВ±Г‘ВЂГђВ°ГђВ¶ГђВ°ГђВµГ‘В‚ ГђВ°ГђВєГ‘В‚Г‘ВѓГђВ°ГђВ»Г‘ВЊГђВЅГ‘В‹ГђВ№ Г‘ВЃГђВЅГђВёГђВјГђВѕГђВє ГђВё ГђВЅГђВµ ГђВёГђВЅГђВёГ‘В†ГђВёГђВёГ‘ВЂГ‘ВѓГђВµГ‘В‚ ГђВґГђВѕГђВїГђВѕГђВ»ГђВЅГђВёГ‘В‚ГђВµГђВ»Г‘ВЊГђВЅГ‘В‹ГђВµ Г‘ВЃГђВѕГђВѕГђВ±Г‘В‰ГђВµГђВЅГђВёГ‘ВЏ, ГђВµГ‘ВЃГђВ»ГђВё Г‘В„ГђВѕГђВЅ Г‘ВѓГђВ¶ГђВµ ГђВїГђВѕГђВ»Г‘ВѓГ‘В‡ГђВёГђВ» Г‘ВЃГђВІГђВµГђВ¶ГђВёГђВµ heartbeat/updates.

## CAP-08: Toolbar action indicator
- chrome.action-РёРєРѕРЅРєР° РІС‹РІРѕРґРёС‚ aggregated totalActiveCount РєСЂСѓРїРЅРѕР№ С†РёС„СЂРѕР№ (OffscreenCanvas + setIcon, СЂР°Р·РјРµСЂС‹ 16/24/32 px, РїСЂРѕР·СЂР°С‡РЅС‹Р№ С„РѕРЅ).
- РџР°Р»РёС‚СЂР° С‚РµРєСЃС‚Р°: 0 #16A34A, 1 #F97316, 2 #F2542D, 3 #E11D48, >=4 #C2185B; Р·РЅР°С‡РµРЅРёСЏ >=10 РѕС‚РѕР±СЂР°Р¶Р°СЋС‚СЃСЏ РєР°Рє 9.
- Tooltip Р»РѕРєР°Р»РёР·РѕРІР°РЅ ("{n} active Codex tasks" / "{n} Р°РєС‚РёРІРЅС‹С… Р·Р°РґР°С‡ Codex"); РїСЂРё РѕС‚СЃСѓС‚СЃС‚РІРёРё canvas РІРєР»СЋС‡Р°РµС‚СЃСЏ fallback badge-text.
## CAP-09: Audio completion cue
- Background audio controller отслеживает AggregatedTabsState.lastTotal и проигрывает сигнал при переходе из >0 в  .
- Web Audio API активируется пользовательским жестом (popup), после чего сигнал может инициироваться фоновой логикой без доп. взаимодействия.
- Контроллер использует mp3 ресурс media/oh-oh-icq-sound.mp3 с fallback на синтез осциллятора.
