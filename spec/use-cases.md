# Use Cases ‚Äî Codex Tasks Watcher

## UC-1: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ–π –∑–∞–¥–∞—á–∏
- **–ê–∫—Ç–æ—Ä—ã:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å Codex, –∫–æ–Ω—Ç–µ–Ω—Ç-—Å–∫—Ä–∏–ø—Ç, background service worker, Chrome Notifications.
- **–ü—Ä–µ–¥—É—Å–ª–æ–≤–∏—è:** –û—Ç–∫—Ä—ã—Ç–∞ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ –≤–∫–ª–∞–¥–∫–∞ Codex; —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∏ –∞–∫—Ç–∏–≤–Ω–æ.
- **–û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫:**
  1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—É—Å–∫–∞–µ—Ç –∑–∞–¥–∞—á—É –≤ Codex.
  2. –ö–æ–Ω—Ç–µ–Ω—Ç-—Å–∫—Ä–∏–ø—Ç —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –ø–æ—è–≤–ª–µ–Ω–∏–µ —Å–ø–∏–Ω–Ω–µ—Ä–∞ (–¥–µ—Ç–µ–∫—Ç–æ—Ä D1) –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `TASKS_UPDATE` —Å `active=true`, `count>=1`.
  3. Background –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ, —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç `totalActiveCount` > 0 –∏ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ.
  4. –ü–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏ –∫–æ–Ω—Ç–µ–Ω—Ç-—Å–∫—Ä–∏–ø—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `TASKS_UPDATE` —Å `count=0`.
  5. Background —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥ `totalActiveCount` —Å >0 –¥–æ 0, –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ç–∞–π–º–µ—Ä –∞–Ω—Ç–∏–¥—Ä–µ–±–µ–∑–≥–∞.
  6. –ü–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –æ–∫–Ω–∞ –∞–Ω—Ç–∏–¥—Ä–µ–±–µ–∑–≥–∞ (‚âà12‚Äì15 —Å) background –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ `totalActiveCount` –≤—Å—ë –µ—â—ë 0, –∏ —Å–æ–∑–¥–∞—ë—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ ¬´–í—Å–µ –∑–∞–¥–∞—á–∏ –≤ Codex –∑–∞–≤–µ—Ä—à–µ–Ω—ã¬ª.
- **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:**
  - –ó–∞–¥–∞—á–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –¥–æ –∏—Å—Ç–µ—á–µ–Ω–∏—è –∞–Ω—Ç–∏–¥—Ä–µ–±–µ–∑–≥–∞, –Ω–æ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –Ω–æ–≤—ã–π —Å–ø–∏–Ω–Ω–µ—Ä ‚Äî —Ç–∞–π–º–µ—Ä —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è.
- **–û—à–∏–±–∫–∏:**
  - –í–∫–ª–∞–¥–∫–∞ –∑–∞–∫—Ä—ã—Ç–∞ –¥–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ `TASKS_UPDATE` ‚Üí background —É–¥–∞–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∫–ª–∞–¥–∫–∏, —Å—É–º–º–∏—Ä—É–µ—Ç –æ—Å—Ç–∞–≤—à–∏–µ—Å—è, –µ—Å–ª–∏ —Å—á—ë—Ç—á–∏–∫ >0, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è.
- **–ü–æ—Å—Ç—É—Å–ª–æ–≤–∏—è:** –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–∫–∞–∑–∞–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑, —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫ –æ–±–Ω—É–ª–µ–Ω–æ.

## UC-2: –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏ –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤–∫–ª–∞–¥–∫–∞—Ö
- **–ê–∫—Ç–æ—Ä—ã:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–Ω—Ç–µ–Ω—Ç-—Å–∫—Ä–∏–ø—Ç–æ–≤, background.
- **–ü—Ä–µ–¥—É—Å–ª–æ–≤–∏—è:** –û—Ç–∫—Ä—ã—Ç–æ ‚â•2 –≤–∫–ª–∞–¥–æ–∫ Codex —Å –∞–∫—Ç–∏–≤–Ω—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏.
- **–û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫:**
  1. –ù–∞ –∫–∞–∂–¥–æ–π –≤–∫–ª–∞–¥–∫–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –∑–∞–¥–∞—á–∏; –∫–æ–Ω—Ç–µ–Ω—Ç-—Å–∫—Ä–∏–ø—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç `TASKS_UPDATE` —Å `count>0`.
  2. Background –∞–≥—Ä–µ–≥–∏—Ä—É–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –ø–æ–ª—É—á–∞–µ—Ç `totalActiveCount = n`, –≥–¥–µ n > 1.
  3. –ü–æ –º–µ—Ä–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞—á –≤–∫–ª–∞–¥–∫–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç `count=0`, background —É–º–µ–Ω—å—à–∞–µ—Ç —Å—É–º–º–∞—Ä–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.
  4. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è `count=0` –æ—Ç –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫ –∏ –≤—ã–¥–µ—Ä–∂–∫–∏ –∞–Ω—Ç–∏–¥—Ä–µ–±–µ–∑–≥–∞.
- **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:**
  - –û–¥–Ω–∞ –≤–∫–ª–∞–¥–∫–∞ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É, –ø–æ–∫–∞ –¥—Ä—É–≥–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω—ã ‚Üí —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è.
- **–û—à–∏–±–∫–∏:**
  - –ü–æ—Ç–µ—Ä—è —Å–≤—è–∑–∏ —Å –≤–∫–ª–∞–¥–∫–æ–π: alarm `codex-poll` –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã–π `PING`, —á—Ç–æ–±—ã –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ.
- **–ü–æ—Å—Ç—É—Å–ª–æ–≤–∏—è:** `totalActiveCount=0`, popup –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç ¬´–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á¬ª.

## UC-3: –í—Å–ø—ã—à–∫–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ (–∞–Ω—Ç–∏–¥—Ä–µ–±–µ–∑–≥)
- **–ê–∫—Ç–æ—Ä—ã:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, –∫–æ–Ω—Ç–µ–Ω—Ç-—Å–∫—Ä–∏–ø—Ç, background.
- **–ü—Ä–µ–¥—É—Å–ª–æ–≤–∏—è:** –ó–∞–¥–∞—á–∏ –∑–∞–≤–µ—Ä—à–µ–Ω—ã, –Ω–æ UI –∫—Ä–∞—Ç–∫–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–ø–∏–Ω–Ω–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞).
- **–û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫:**
  1. –ö–æ–Ω—Ç–µ–Ω—Ç-—Å–∫—Ä–∏–ø—Ç —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –ø–æ—è–≤–ª–µ–Ω–∏–µ —Å–ø–∏–Ω–Ω–µ—Ä–∞ D1 –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `TASKS_UPDATE` —Å `count=1`.
  2. –ß–µ—Ä–µ–∑ <1 —Å–µ–∫—É–Ω–¥—ã –ø–æ—Å–ª–µ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è —Å–ø–∏–Ω–Ω–µ—Ä–∞ (debounce –∫–æ–Ω—Ç–µ–Ω—Ç-—Å–∫—Ä–∏–ø—Ç–∞ 500 –º—Å) –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è `TASKS_UPDATE` —Å `count=0`.
  3. Background –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç, —á—Ç–æ `totalActiveCount` –≤–µ—Ä–Ω—É–ª—Å—è –≤ 0, –Ω–æ –∞–Ω—Ç–∏–¥—Ä–µ–±–µ–∑–≥ –µ—â—ë –Ω–µ –∏—Å—Ç—ë–∫.
  4. –ï—Å–ª–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ –æ–∫–Ω–∞ –∞–Ω—Ç–∏–¥—Ä–µ–±–µ–∑–≥–∞ –Ω–æ–≤—ã—Ö —Å–∏–≥–Ω–∞–ª–æ–≤ –Ω–µ—Ç, —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è. –ï—Å–ª–∏ —Å–∏–≥–Ω–∞–ª –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è, –æ–∫–Ω–æ –ø—Ä–æ–¥–ª–µ–≤–∞–µ—Ç—Å—è.
- **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:**
  - –ù–∞—Å—Ç–æ—è—â–∞—è –∑–∞–¥–∞—á–∞ —Å—Ç–∞—Ä—Ç—É–µ—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ –æ–∫–Ω–∞ ‚Üí `count` —Å–Ω–æ–≤–∞ >0, –∞–Ω—Ç–∏–¥—Ä–µ–±–µ–∑–≥ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è.
- **–û—à–∏–±–∫–∏:**
  - –í–∫–ª–∞–¥–∫–∞ –≤—ã–≥—Ä—É–∂–∞–µ—Ç—Å—è —Å–∏—Å—Ç–µ–º–æ–π –¥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–∫–Ω–∞ ‚Üí background –ø—Ä–∏–º–µ–Ω—è–µ—Ç `autoDiscardableOff`, —á—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –≤—ã–≥—Ä—É–∑–∫—É.
- **–ü–æ—Å—Ç—É—Å–ª–æ–≤–∏—è:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –∑–∞–≤–µ—Ä—à–∏–ª–∞—Å—å.

## UC-4: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á –≤ popup
- **–ê–∫—Ç–æ—Ä—ã:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å, popup UI, background.
- **–ü—Ä–µ–¥—É—Å–ª–æ–≤–∏—è:** –ï—Å—Ç—å —Ö–æ—Ç—è –±—ã –æ–¥–Ω–∞ –≤–∫–ª–∞–¥–∫–∞ Codex —Å `count>0`.
- **–û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫:**
  1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç popup —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è.
  2. Popup –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ `POPUP_GET_STATE` —á–µ—Ä–µ–∑ `chrome.runtime.sendMessage`, –ø—Ä–æ–±—É–∂–¥–∞—è service worker –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
  3. Background —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç `PopupRenderState`: —Å–Ω–∏–º–∞–µ—Ç —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä–∞, –≤—ã—á–∏—Å–ª—è–µ—Ç `totalActive`, —Å–æ—Ä—Ç–∏—Ä—É–µ—Ç –≤–∫–ª–∞–¥–∫–∏ –ø–æ `count`/`lastSeenAt`, –¥–æ–±–∞–≤–ª—è–µ—Ç –ª–æ–∫–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã.
  4. Popup –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –ø–µ—Ä–µ—á–µ–Ω—å –∑–∞–¥–∞—á –≤ –ø–æ—Ä—è–¥–∫–µ –≤–∞–∂–Ω–æ—Å—Ç–∏; —Å–∏–≥–Ω–∞–ª—ã –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ —Å–ø–∏—Å–∫–µ –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –≤–∫–ª–∞–¥–∫–∏.
- **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:**
  - –ï—Å–ª–∏ `count=0` –ø–æ –≤—Å–µ–º –≤–∫–ª–∞–¥–∫–∞–º, popup –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ ¬´–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á¬ª.
- **–û—à–∏–±–∫–∏:**
  - –°–µ—Ä–≤–∏—Å-–≤–æ—Ä–∫–µ—Ä —Å–ø–∏—Ç ‚Üí popup –ø–æ–≤—Ç–æ—Ä—è–µ—Ç `chrome.runtime.sendMessage`, —á—Ç–æ–±—ã –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ —Ä–∞–∑–±—É–¥–∏—Ç—å –≤–æ—Ä–∫–µ—Ä –∏ –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç.
- **–ü–æ—Å—Ç—É—Å–ª–æ–≤–∏—è:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–ª—É—á–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—É—é —Å–≤–æ–¥–∫—É –∑–∞–¥–∞—á –±–µ–∑ –ª–∏—à–Ω–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π.


## UC-5: –ü–æ—Ç–µ—Ä—è heartbeat –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
- **–ê–∫—Ç–æ—Ä—ã:** –ö–æ–Ω—Ç–µ–Ω—Ç-—Å–∫—Ä–∏–ø—Ç, background service worker, Chrome Alarms.
- **–ü—Ä–µ–¥—É—Å–ª–æ–≤–∏—è:** –í–∫–ª–∞–¥–∫–∞ Codex –æ—Ç–∫—Ä—ã—Ç–∞, –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á –Ω–µ—Ç (`count=0`), –Ω–æ –∫–æ–Ω—Ç–µ–Ω—Ç-—Å–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ—Å—Ç–∞–ª –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å `TASKS_HEARTBEAT` (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–∫–ª–∞–¥–∫–∞ —Å–≤–µ—Ä–Ω—É—Ç–∞ –∏ –∑–∞–º–æ—Ä–æ–∂–µ–Ω–∞).
- **–û—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫:**
  1. Alarm `codex-poll` —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç, –≤—ã–∑—ã–≤–∞–µ—Ç `evaluateHeartbeatStatuses()` –∏ –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç, —á—Ç–æ `now - lastReceivedAt >= expectedIntervalMs * 3`; –≤–∫–ª–∞–¥–∫–∞ –ø–æ–º–µ—á–∞–µ—Ç—Å—è –∫–∞–∫ `STALE`, `missedCount` —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è.
  2. Background –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤–∫–ª–∞–¥–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–µ `PING`.
  3. –ö–æ–Ω—Ç–µ–Ω—Ç-—Å–∫—Ä–∏–ø—Ç –ø–æ–ª—É—á–∞–µ—Ç `PING`, –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ DOM, —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–π `TASKS_UPDATE` –∏ `TASKS_HEARTBEAT` (—Å `respondingToPing=true`).
  4. Background –æ–±–Ω–æ–≤–ª—è–µ—Ç `lastSeenAt`, —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç `missedCount`, —Å—Ç–∞—Ç—É—Å —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è `OK` –∏ –≤–∫–ª–∞–¥–∫–∞ —Å–Ω–æ–≤–∞ —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏.
- **–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã:**
  - –í–∫–ª–∞–¥–∫–∞ –∑–∞–∫—Ä—ã—Ç–∞ –¥–æ –æ—Ç–ø—Ä–∞–≤–∫–∏ `PING` ‚Üí —Å–æ–±—ã—Ç–∏–µ `tabs.onRemoved` —É–¥–∞–ª—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ, heartbeat –±–æ–ª—å—à–µ –Ω–µ –æ–∂–∏–¥–∞–µ—Ç—Å—è.
- **–û—à–∏–±–∫–∏:**
  - –ö–æ–Ω—Ç–µ–Ω—Ç-—Å–∫—Ä–∏–ø—Ç –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ `PING` ‚Üí background –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –ø–æ–ø—ã—Ç–∫—É –Ω–∞ —Å–ª–µ–¥—É—é—â–µ–º alarm –∏ –ª–æ–≥–∏—Ä—É–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –¥–ª—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.
- **–ü–æ—Å—Ç—É—Å–ª–æ–≤–∏—è:** `lastSeenAt` –æ—Ç—Ä–∞–∂–∞–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞; –µ—Å–ª–∏ –≤–∫–ª–∞–¥–∫–∞ –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏–ª–∞—Å—å, background –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –ø–æ–º–µ—á–∞—Ç—å –µ—ë –∫–∞–∫ `STALE` –∏ –Ω–µ —É—á–∏—Ç—ã–≤–∞–µ—Ç —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Ä–∞—Å—á—ë—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.
## UC-6: Monitoring Codex tasks from the toolbar badge
- **Actors:** Background worker, Chrome toolbar, Codex operator.
- **Preconditions:** Aggregator is active; extension action is pinned in the toolbar.
- **Main Flow:**
  1. Aggregator receives TASKS_UPDATE and updates lastTotal.
  2. Action indicator derives badge text/color and updates chrome.action APIs.
  3. Operator glances at the toolbar badge and sees the current count and severity color.
- **Alternatives:** If chrome.action APIs are unavailable, the indicator logs a warning and keeps previous badge value.
- **Postconditions:** Badge reflects the newest aggregated count; tooltip matches the localized template.
## UC-7: «‚ÛÍÓ‚ÓÈ ÒË„Ì‡Î Á‡‚Â¯ÂÌËˇ Á‡‰‡˜
- **Actors:** Background service worker, Popup (‰Îˇ ‡ÍÚË‚‡ˆËË), ÔÓÎ¸ÁÓ‚‡ÚÂÎ¸.
- **œÂ‰ÛÒÎÓ‚Ëˇ:** œÓÎ¸ÁÓ‚‡ÚÂÎ¸ ÓÚÍ˚Î popup ıÓÚˇ ·˚ Ó‰ËÌ ‡Á, AudioContext ‡ÍÚË‚ËÓ‚‡Ì.
- **ŒÒÌÓ‚ÌÓÈ ÔÓÚÓÍ:**
  1. Aggregator ÙËÍÒËÛÂÚ lastTotal >0.
  2. œÓÒÎÂ Ó˜ÂÂ‰ÌÓ„Ó TASKS_UPDATE lastTotal ÒÚ‡ÌÓ‚ËÚÒˇ  .
  3. Audio notifier ‚ÓÒÔÓËÁ‚Ó‰ËÚ ÍÓÓÚÍËÈ ÒË„Ì‡Î (mp3 ËÎË fallback Web Audio).
- **¿Î¸ÚÂÌ‡ÚË‚˚:** ≈ÒÎË AudioContext ÌÂ‡ÍÚË‚ÂÌ, ÒÓ·˚ÚËÂ ÔÓÏÂ˜‡ÂÚÒˇ Í‡Í pending ‰Ó ÒÎÂ‰Û˛˘ÂÈ ‡ÍÚË‚‡ˆËË.
- **œÓÒÚÛÒÎÓ‚Ëˇ:** œÓÎ¸ÁÓ‚‡ÚÂÎ¸ ÔÓÎÛ˜‡ÂÚ Á‚ÛÍÓ‚ÓÂ Û‚Â‰ÓÏÎÂÌËÂ Â‰ËÌÓÊ‰˚ ‰Îˇ ÔÂÂıÓ‰‡ >0 -> 0.
