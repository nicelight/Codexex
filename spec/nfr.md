# Non-Functional Requirements — Codex Tasks Watcher

## Performance
- Контент-скрипт выполняет не более одного полного сканирования DOM в секунду; события MutationObserver объединяются в батчи.
- Средняя загрузка CPU от расширения не превышает 2% на вкладку в простое и 5% при активной задаче.
- Уведомление отображается не позднее чем через 3 секунды после истечения окна антидребезга.

## Reliability & Resilience
- Service worker обязан восстанавливаться после выгрузки: alarm `codex-poll` запускается не реже одного раза в минуту.
- Контент-скрипт отправляет `TASKS_HEARTBEAT` не реже чем раз в 15 секунд (или сразу после `PING`), background фиксирует `missedCount` и помечает вкладку как `STALE`, если heartbeat отсутствует в течение 45 секунд.
- Состояние вкладок синхронизируется в `chrome.storage.session`; при ошибке записи предпринимается повтор через 1 секунду с явной обработкой `chrome.runtime.lastError`, покрытой unit-тестами.
- Расширение корректно работает при открытых фоновых вкладках (не активных) и при восстановлении после сна ОС; «устаревшие» вкладки автоматически инициируют повторное сканирование.

## Security & Privacy
- Runtime-валидаторы JSON Schema не должны полагаться на `eval`/`new Function`; используем заранее скомпилированные ajv-функции, совместимые с CSP Manifest V3.
- Расширение не делает внешних сетевых запросов и не сохраняет данные вне `chrome.storage.session`.
- Минимальный набор прав: `storage`, `notifications`, `alarms`, `scripting`, `tabs`, `host_permissions` (`https://*.openai.com/*`, `https://*.chatgpt.com/*`).
- Контент-скрипт не изменяет DOM Codex, только читает состояние и отправляет сообщения.

## Usability & UX
- Уведомления формулируются на языке интерфейса браузера (RU/EN локализация через i18n сообщений).
- Popup предоставляет понятный список активных задач с ссылками на вкладки; при отсутствии задач отображает явный статус.
- Повторные уведомления не генерируются, пока суммарный счётчик не станет >0 вновь (идемпотентность).

## Maintainability
- ActivityScanner реализован одним модулем с прямым обходом DOM; любые предложения добавить новые пайплайны или усложнить архитектуру требуют предварительного согласования с заказчиком.
- Код расширения разделён на слои: content, background, popup. Общие типы и утилиты вынесены в отдельную директорию.
- Каждое изменение детекторов сопровождается обновлением JSON Schema и тестов.

## Observability
- Background логирует ключевые события (получение `TASKS_UPDATE`, запуск уведомления, ошибки записи в storage) через `console.log` (в dev) и `chrome.runtime.lastError`.
- Возможность включить verbose-режим через флаг в `chrome.storage.session` (dev build).

## Compliance & Distribution
- Соответствие требованиям Chrome Web Store: политика приватности указывает на отсутствие сбора данных.
- Manifest V3 с корректно указанными разрешениями и иконками 16/48/128 px.
- План обновления: v0.1.0 (MVP) → v0.2.0 (настройки/бейдж) с совместимыми контрактами.

