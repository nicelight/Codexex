import{r as f,d as h}from"./chrome-CDKoC93C.js";import{l as v,g,s as d}from"./messages-B9y2QbG0.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))n(e);new MutationObserver(e=>{for(const s of e)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function o(e){const s={};return e.integrity&&(s.integrity=e.integrity),e.referrerPolicy&&(s.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?s.credentials="include":e.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(e){if(e.ep)return;e.ep=!0;const s=o(e);fetch(e.href,s)}})();async function E(){const t=f();return new Promise((a,o)=>{try{t.runtime.sendMessage({type:"POPUP_GET_STATE"},n=>{const e=t.runtime.lastError;if(e){o(new Error(e.message));return}try{h(n),a(n)}catch(s){o(s)}})}catch(n){o(n)}})}async function N(t){const a=M(),o=g(a);k(t,o);try{const[n,e]=await Promise.all([E(),v()]);b(t,n,e)}catch(n){console.error("Failed to load popup state",n),D(t,o,a)}}function b(t,a,o){const e={...g(a.locale),...a.messages??{}};typeof document<"u"&&(document.documentElement.lang=a.locale,document.title=e.title??"Codex Tasks Watcher");const s=document.createElement("div");s.className="popup",s.append(y(a,e,o),w(a,e)),t.replaceChildren(s)}function y(t,a,o){const n=document.createElement("header");n.className="popup__header";const e=document.createElement("h1");e.className="popup__title",e.textContent=a.title??"Codex Tasks Watcher",n.append(e);const s=document.createElement("div");s.className="popup__meta";const r=document.createElement("div");r.className="popup__total";const c=document.createElement("span");c.className="popup__total-label",c.textContent=a["totalActive.label"]??"Active tasks";const u=document.createElement("span");u.className="popup__total-count",u.textContent=String(t.totalActive),r.append(c,u);const l=document.createElement("div");l.className="popup__updated";const _=a["updatedAt.label"]??"Updated";return l.textContent=`${_}: ${P(t.generatedAt,t.locale)}`,s.append(r,l),n.append(s,C(t.locale,o)),n}const p={en:{toggleOn:"Disable sound notifications",toggleOff:"Enable sound notifications",volume:"Notification volume"},ru:{toggleOn:"Ð’Ñ‹ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð·Ð²ÑƒÐºÐ¾Ð²Ñ‹Ðµ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ",toggleOff:"Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð·Ð²ÑƒÐºÐ¾Ð²Ñ‹Ðµ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ",volume:"Ð“Ñ€Ð¾Ð¼ÐºÐ¾ÑÑ‚ÑŒ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹"}};function C(t,a){const o=p[t]??p.en,n=document.createElement("div");n.className="popup__controls";const e={sound:a.sound,soundVolume:i(a.soundVolume)},s=document.createElement("button");s.type="button",s.className="popup__sound-toggle",s.textContent=e.sound?"ðŸ””":"ðŸ”•",s.title=e.sound?o.toggleOn:o.toggleOff,s.setAttribute("aria-pressed",e.sound?"true":"false");const r=document.createElement("input");return r.type="range",r.className="popup__volume-slider",r.min="0",r.max="100",r.value=String(Math.round(e.soundVolume*100)),r.step="1",r.setAttribute("aria-label",o.volume),r.disabled=!e.sound,s.addEventListener("click",()=>{e.sound=!e.sound,s.textContent=e.sound?"ðŸ””":"ðŸ”•",s.setAttribute("aria-pressed",e.sound?"true":"false"),s.title=e.sound?o.toggleOn:o.toggleOff,r.disabled=!e.sound,d({sound:e.sound}),e.sound&&i(Number(r.value)/100)===0&&(r.value=String(Math.round(e.soundVolume*100)))}),r.addEventListener("input",()=>{const c=i(Number(r.value)/100);e.soundVolume=c}),r.addEventListener("change",()=>{const c=i(Number(r.value)/100);e.soundVolume=c,d({soundVolume:c}),e.sound&&L.play(c).catch(u=>{console.warn("Sound preview failed",u)})}),n.append(s,r),n}const m="media/oh-oh-icq-sound.mp3";class S{async play(a){const o=i(a);if(o<=0)return;const n=await this.ensureAudio();if(n){n.pause(),n.currentTime=0,n.volume=o;try{await n.play()}catch(e){console.warn("Audio playback failed",e)}}}async ensureAudio(){var e;if(this.audio)return this.audio;if(typeof Audio>"u")return;const a=f(),o=(e=a.runtime)!=null&&e.getURL?a.runtime.getURL(m):m,n=new Audio(o);return n.preload="auto",this.audio=n,this.audio}}const L=new S;function i(t){return!Number.isFinite(t)||t<=0?0:t>=1?1:t}function w(t,a){const o=document.createElement("main");if(o.className="popup__content",t.tabs.length===0||t.totalActive===0){const e=document.createElement("div");return e.className="popup__empty",e.textContent=a.noActiveTasks??"No active tasks",o.append(e),o}const n=document.createElement("ul");n.className="popup__tabs";for(const e of t.tabs)n.append(x(e,t,a));return o.append(n),o}function x(t,a,o){const n=document.createElement("li");n.className="popup__tab";const e=document.createElement("div");e.className="popup__tab-header";const s=document.createElement("div");s.className="popup__tab-title",s.textContent=t.title;const r=document.createElement("div");r.className="popup__tab-count",r.textContent=U(t.count,a.locale,o),e.append(s,r),n.append(e);const c=document.createElement("div");if(c.className="popup__tab-subtitle",c.textContent=O(t,a.locale,o),n.append(c),t.heartbeatStatus==="STALE"){const u=document.createElement("div");u.className="popup__tab-warning",u.textContent=o["heartbeat.stale"]??"Connection lost",n.append(u)}return t.signals.length>0&&n.append(A(t,o)),n}function A(t,a){const o=document.createElement("div");o.className="popup__signals";const n=document.createElement("div");n.className="popup__signals-title",n.textContent=a["signals.heading"]??"Signals";const e=document.createElement("ul");e.className="popup__signals-list";for(const s of t.signals){const r=document.createElement("li");r.className="popup__signal";const c=document.createElement("span");c.className="popup__signal-detector",c.textContent=s.detector;const u=document.createElement("span");u.className="popup__signal-evidence",u.textContent=s.evidence,r.append(c,u),e.append(r)}return o.append(n,e),o}function O(t,a,o){const n=V(t.origin),e=typeof t.lastSeenAt=="number"?T(t.lastSeenAt,a):void 0;if(e){const r=(o["tab.lastSeen"]??"Last activity: {{time}}").replace("{{time}}",e);return n?`${n} â€¢ ${r}`:r}return n??""}function P(t,a){const o=new Date(t);return Number.isNaN(o.getTime())?t:new Intl.DateTimeFormat(a,{hour:"2-digit",minute:"2-digit",year:"numeric",month:"short",day:"numeric"}).format(o)}function T(t,a){return new Intl.DateTimeFormat(a,{hour:"2-digit",minute:"2-digit"}).format(new Date(t))}function U(t,a,o){const s=[`taskCount.${new Intl.PluralRules(a).select(t)}`,"taskCount.other"];for(const r of s){const c=o[r];if(c)return c.replace("{{count}}",String(t))}return String(t)}function k(t,a){const o=document.createElement("div");o.className="popup popup--loading";const n=document.createElement("div");n.className="popup__loading",n.textContent=a.loading??"Loadingâ€¦",o.append(n),t.replaceChildren(o)}function D(t,a,o){typeof document<"u"&&(document.documentElement.lang=o);const n=document.createElement("div");n.className="popup popup--error";const e=document.createElement("div");e.className="popup__error",e.textContent=a["error.failedToLoad"]??"Unable to load tasks. Please reopen the popup.",n.append(e),t.replaceChildren(n)}function M(){var a;return(((a=globalThis.navigator)==null?void 0:a.language)??"en").toLowerCase().startsWith("ru")?"ru":"en"}function V(t){try{return new URL(t).hostname}catch{return}}if(typeof document<"u"){const t=document.getElementById("app");t&&N(t)}
